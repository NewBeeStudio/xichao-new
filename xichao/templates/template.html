{% extends "layout.html" %}

<!--css file used-->
{% block css %}
<link href="{{ url_for('static', filename='css/index.css') }}" rel='stylesheet' type='text/css'/> 
{% endblock %}

<!--content-->
{% block content %}
	<h2>
			热门专栏
	</h2>
	<div id="index-up">

	{% for i in range(4) %}
		<!-- data-index值从"0"到"3" -->
		<div id="index-up-{{i}}" data-index="{{i}}" style="background-image: url('{{slideUrl[i]}}');">
			<div class="index-up-content">
				<div class="index-up-content-left">
					<a href="{{url_for('special')}}?id={{special_list[i].special_id}}&page=1&sort=time">
					<h3>

						{{ special_list[i].name }}
					</h3>

				    </a>
				</div>

				<div class="index-up-content-right">
					<div>
						<div class="index-special-abstract">
							<font style="font-size: 18.8px; font-weight: bold;">简介：</font>{{ special_list[i].introduction }}
						</div>
						<table class="index-special-recommend">
						<ul>
                            {% for article in articles(special_list[i].special_id, 1, "time", 5).items %}
                                <tr>
                                    <td width="250">    <a href = "{{url_for('article', article_id = article.article_id)}}" > <li>{{ article.title }}</li> </a> </td>
                                    <td width="150" style="color:grey;">{{ article.time | time_split_2 }}</td>
                                    <td>
                                    <img style="width: 21px;height: 21px;" src="{{ url_for('static', filename='images/coins.png') }}">
                                    {{ article.coins }}
                                    </td>
                                </tr>
                            {% endfor %}
						</ul>
						</table>
	
						<a href="{{url_for('special')}}?id={{special_list[i].special_id}}&page=1&sort=time" style="float:right;font-family: 微软雅黑;">&gt;&gt;&gt;&gt;&nbsp;View More</a>
					</div>
				</div>
			</div>
		</div>
	{% endfor %}
	</div>

	<div>
		<a href="{{url_for('special_all')}}?sort=time&page=1" class="index-view-more" style="margin-top: 30px;">&gt;&gt;&gt;&gt;&nbsp;View More</a>
	</div>

	<div id="index-middle">
		<h2>
			热门文章
		</h2>
		<div style="margin-top: 30px;"></div>
		{% set counterIndex = 0 %}
		{% for article in hot_articles %}
		{% if counterIndex % 5 == 0 %}
		<div style="height: 390px;">
		{% endif %}
		<div class="index-hot">
		<a href="{{url_for('article', article_id = article.article_id)}}">
			<img src="/upload/article/article_title_image/article_upload_pic_1.jpg">
			<div class="index-hot-title">{{article.title}}</div>
        </a>
			<div class="index-hot-author">{{get_author(article.user_id)}}&nbsp;&nbsp;曦潮币({{article.coins}})&nbsp;&nbsp;{{article.time|time_split_2}}</div>
			<div style="clear:both;"></div>
			<div class="index-hot-abstract">{{article.abstract}}</div>
		</div>

		{% if counterIndex % 5 == 4 %}
		</div>
		{% endif %}

		{% set counterIndex = counterIndex + 1 %}
		{% endfor %}

	</div>

	<div>
		<a href="#" class="index-view-more">&gt;&gt;&gt;&gt;&nbsp;View More</a>
	</div>

	<div id="index-bottom">
		<div>
			<h2>广场热门</h2>
			<div class="index-bottom-detail">
				<a href="#">
					<div class="index-bottom-img">
						<img src="/static/images/square-1.jpg">
					</div>
				</a>
				
				<div class="index-bottom-article">
					<a href=""><div class="index-bottom-title">与尔同消万古愁</div></a>
					<div class="index-bottom-author">丁小云&nbsp;&nbsp;曦潮币(330)&nbsp;&nbsp;2014-02-23</div>
					<div style="clear:both;"></div>
					<div class="index-bottom-abstract">与尔同消万古愁与尔同消万古愁与尔同消万古愁与尔同消万古愁与尔同消万古愁与尔同消万古愁</div>
				</div>
			</div>
			<div>
				<a href="#" class="index-view-more" style="margin-top: 30px;">&gt;&gt;&gt;&gt;&nbsp;View More</a>
			</div>
			
		</div>

		<div style="float: right;" >
			<h2>当前活动</h2>
			<div class="index-bottom-detail">
				<a href="#">
					<div class="index-bottom-img">
						<img src="/static/images/square-1.jpg">
					</div>
				</a>
				
				<div class="index-bottom-article">
					<a href=""><div class="index-bottom-title">与尔同消万古愁</div></a>
					<div class="index-bottom-author">收藏(330)&nbsp;&nbsp;2014-02-23</div>
					<div style="clear:both;"></div>
					<div class="index-bottom-abstract">与尔同消万古愁与尔同消万古愁与尔同消万古愁与尔同消万古愁与尔同消万古愁与尔同消万古愁</div>
				</div>
			</div>
			<div>
				<a href="#" class="index-view-more" style="margin-top: 30px;">&gt;&gt;&gt;&gt;&nbsp;View More</a>
			</div>
		</div>
	</div>
{% endblock %}


<!--js file used-->
{% block js %}
<script src="{{ url_for('static', filename='layer-v1.8.5/layer/layer.min.js') }}"></script>
<script type="text/javascript">
	$(document).ready(function()
	{
	
			//未验证邮箱弹窗
    {% if not current_user.is_anonymous() %}
		if({{current_user.state}} == 0){
			var url = "{{ url_for('verify_remind') }}";
			$.layer({
				type: 2,
				title: ['请验证邮箱'],
				shade: [0.65, '#000'],
				shadeClose: true,
				closeBtn: false,
				border: [2, 1, '#D9AE48'],
				area: ['350px', '200px'],
				iframe: {src: url}
			});
		};
    {% endif %}	
		
		// 主页上面的四副图片
		var gap = 120; //图片间距，不可变
		var picNum = 4; //不可变
		var MouseIn = false;

		$('#index-up > div').each(function()
		{
			var offset = parseInt($(this).attr("data-index"))*271 + "px";
			$(this).css("left", offset);
		});
        var autoTimer;
        var autoIndex=0;

		var onMouseIn = function()
		{
		    MouseIn = true;
		    clearInterval(autoTimer);

			var index = parseInt($(this).attr("data-index")); 
			$("#index-up > div").each(function()
			{
				$(this).stop(true, false); //停止之前效果(参数二：是否到达最后结果)
				var curIndex = parseInt($(this).attr("data-index"));
				var leftOrIn = gap * curIndex;
				var right = 1087 - (picNum - curIndex) * gap;

				//alert("leftOrIn");
				if(curIndex <= index)
					$(this).animate({left:leftOrIn+"px"}, 600);
				else
					$(this).animate({left:right+"px"}, 600);
			});
		};

        
		var autoOnMouseIn = function()
		{
		    if (!MouseIn){
		    index = autoIndex;
		    autoIndex = autoIndex + 1;
		    
		    if (autoIndex == 4) autoIndex = 0;
			$("#index-up > div").each(function()
			{
				$(this).stop(true, false); //停止之前效果(参数二：是否到达最后结果)
				var curIndex = parseInt($(this).attr("data-index"));
				var leftOrIn = gap * curIndex;
				var right = 1087 - (picNum - curIndex) * gap;

				//alert("leftOrIn");
				if(curIndex <= index)
					$(this).animate({left:leftOrIn+"px"}, 600);
				else
					$(this).animate({left:right+"px"}, 600);
			});}
		};
        
        autoOnMouseIn();
        autoTimer = setInterval(autoOnMouseIn, 2500);


		var onMouseOut = function()
		{
            MouseIn = false;
            autoIndex = parseInt($(this).attr("data-index"));
			$("#index-up > div").each(function()
			{
				$(this).stop(true, false);
				var curIndex = parseInt($(this).attr("data-index"));
				var left = 271*curIndex;
				$(this).animate({left:left+"px"}, 300);

			});
            autoOnMouseIn();
            autoTimer = setInterval(autoOnMouseIn, 2500);
		};

        
		$("#index-up > div").hover(onMouseIn, onMouseOut);
	});
</script>

{% endblock %}
