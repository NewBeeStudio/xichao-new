{% extends "layout.html" %}

<!--css file used-->
{% block css %}
<link rel="stylesheet" type="text/css" href="/static/jquery-ui-1.11.2/jquery-ui.css" />
<link href="{{ url_for('static', filename='css/square.css') }}" rel='stylesheet' type='text/css'/> 
<link href="{{ url_for('static', filename='css/homepage.css') }}" rel='stylesheet' type='text/css'/> 
{% endblock %}

<!--content-->
{% block content %}
	<div style="margin-top: 87px;">
	<!-- 个人简介 -->
	<div class="square-part1">
		<!-- 头像 -->
		<div class="square-part1-left">
			<h2 style="line-height: 40px">个人简介</h2>
			<img id="square-part1-img" style="background-image: url('{{user.photo}}')" src="{{ url_for('static', filename='images/transparent-circle.png') }}"/>
			<div></div>
		</div>

		<!-- 介绍 -->
		<div class="home-introduction">
			<table>
				<tr>
					<td class="home-col-1">{{user.nick}}</td>
					<td class="home-col-2">关注<br/>{{user.follow_num}}</td>
					<td class="home-col-3">被关注<br/><font id="home_be_followed_num">{{user.be_followed_num}}</font></td>
					<td class="home-col-4">
					{% if collection=='yes' %}
						<input type="button" value="取消关注" id="collection_user">
					{% else %}
						<input type="button" value="关注" id="collection_user">
					{% endif %}</td>
					<td class="home-col-5"><input type="button" value="发送私信" id="message_button"></td>
				</tr>
			</table>

			<div>
				{{user.slogon}}
			</div>
		</div>
	
	</div>
	
	<!-- 文章列表 -->
	<div class="square-part2" id="home-article-list">
		<!-- 内容 -->
		<div class="square-part2-left" style="width:703px;">
			<div id="home-select">
				<label>排序方式：</label>
				<select name="sorting">
					<option id="sorting-by-time" value="time" selected="selected">时 间</option>
					<option id="sorting-by-heat" value="heat">热 度</option>
				</select>
			</div>

			<div id="ajax-field">
			<table id="square-part1-content" style="width:703px; margin-top: 60px;">
				{% for article in article_pagination.items %}
				<tr>
					<td class="square-col-1" style="width:500px;"><a href="#">{{article.title}}</a></td>
					<td class="square-col-3"><img src="{{ url_for('static', filename='images/coins.png') }}"></td>
					<td class="square-col-4" style="width: 80px;">{{article.coins}}</td>
					<td class="square-col-final">{{article.time|time_split}}</td>
				</tr>
				{% endfor %}
			</table>

			<div id="home-paging">
				{%if article_pagination.has_prev %}
				<a href="#home-article-list" id="home-left-arrow">&lt;&lt;</a>&nbsp;&nbsp;&nbsp;
				{% endif %}
				Page&nbsp;{{ article_pagination.page }}&nbsp;/&nbsp;{{ article_pagination.pages }}
				{%if article_pagination.has_next %}
				&nbsp;&nbsp;&nbsp;<a href="#home-article-list" id="home-right-arrow">&gt;&gt;</a>
				{% endif %}
			</div>
			</div>
		</div>
	
		<!-- 标题图片 -->
		<div class="square-part2-right">
			<h2 style="line-height: 40px">文章列表</h2>
			<img id="square-part2-img" src="{{ url_for('static', filename='images/transparent-circle.png') }}"/>
			<div></div>
		</div>
	
	</div>

	<!-- 关注作者 -->
	<div id="home-star">
		<h2>关注的作者：</h2>
		<div style="margin-top: 30px"></div>
		<div class="home-star-row">
		{% for author in collection_author_list%}
			<div><img src="{{url_for('static', filename='images/transparent-circle.png')}}" style="background-image: url('{{author.photo}}')"/><div class="home-star-name"><a href="{{url_for('view_home_page', nick=author.nick)}}">{{author.nick}}</a></div></div>
		{% endfor %}
		</div>

	</div>
	
{% endblock %}


<!--js file used-->
{% block js %}
<script src="{{ url_for('static', filename='layer-v1.8.5/layer/layer.min.js') }}"></script>
<script type="text/javascript">
	$(document).ready(function()
	{
		if ('{{collection}}'=='yes'){
			flag=true;
		}
		else{
			flag=false;
		}
		$("#collection_user").click(function()
		{
			if (flag) {url='/collection_cancel/user';}
			else{url='/collection/user';}
			$.post(url,
			{
			user_id: {{user.user_id}}
			},
			function(data){
			if (data=='success'){
				var follow_num = parseInt($('#home_be_followed_num').html());
				if (flag) {
					layer.msg("取消关注成功",1,1);
					$("#collection_user").val("关注");
					var newstr = (follow_num-1);
					$('#home_be_followed_num').html(newstr);
					flag=false;
				}
				else{
					layer.msg("关注成功",1,1);
					$("#collection_user").val("取消关注");
					var newstr = (follow_num+1);
					$('#home_be_followed_num').html(newstr);
					flag=true;
				}
			}
			else {
				if ('{{collection}}'=='yes'){
					layer.msg("关注失败",1,3);
				}
				else{
					layer.msg("取消关注失败",1,3);
				}
			}
			});  
		});


		$("#message_button").click(function()
		{
			var url = "{{ url_for('message_page', to_user_id=user.user_id) }}";
			$.layer({
				type: 2,
				title: ['私信'],
				shade: [0.65, '#000'],
				shadeClose: true,
				closeBtn: false,
				border: [2, 1, '#D9AE48'],
				area: ['560px', '258px'],
				iframe: {src: url},
			});
		});

		// $("#home-left-arrow").click(function()
		// {
			
		// 	var url = "";
		// 	if($("#sorting-by-time").attr('selected') == 'selected')
		// 		url = {{url_for('ajax_article_pagination_by_time', user_id = user.user_id, page_id = article_pagination.prev_num)}};
		// 	else
		// 		url = {{url_for('ajax_article_pagination_by_coins', user_id = user.user_id, page_id = article_pagination.prev_num)}};

			// $.get(url, function(result)
			// {
   //  			$("div").html(result);
  	// 		});
		// });

		$("#home-right-arrow").click(function()
		{
			var url = "";
			if($("#sorting-by-time").attr('selected') == 'selected'){
				url = "{{url_for('ajax_article_pagination_by_time', user_id = user.user_id, page_id = article_pagination.next_num)}}";
			}
			else{
				url = "{{url_for('ajax_article_pagination_by_coins', user_id = user.user_id, page_id = article_pagination.next_num)}}";
			}
			// alert(url);

			// alert($("#sorting-by-time").attr('selected'));
			
			$.get(url, function(result)
			{
    			$('#ajax-field').remove();
    			// $("div").html(result);
  			});
		});

	});
</script>
{% endblock %}